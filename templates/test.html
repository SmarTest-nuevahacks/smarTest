<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>smarTest</title>
<link rel="icon" href="{{ url_for('static',filename='pics/favicon.png') }}" type="image/x-icon"/>
  <!-- Bootstrap core CSS -->
  <link href="{{ url_for('static',filename='vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="{{ url_for('static',filename='css/one-page-wonder.min.css') }}" rel="stylesheet">

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script>
  <script src="http://www.skulpt.org/js/skulpt.min.js" type="text/javascript"></script>
  <script src="http://www.skulpt.org/js/skulpt-stdlib.js" type="text/javascript"></script>

   <!-- Fa-Fa -->
  <script src="https://kit.fontawesome.com/301b488078.js" crossorigin="anonymous"></script>
   <!-- Easy-Button -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
  <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

  <script type="text/javascript">
  function addEvent(obj, evt, fn) {
      if (obj.addEventListener) {
          obj.addEventListener(evt, fn, false);
      }
      else if (obj.attachEvent) {
          obj.attachEvent("on" + evt, fn);
      }
  }
  addEvent(window,"load",function(e) {
      addEvent(document, "mouseout", function(e) {
          e = e ? e : window.event;
          var from = e.relatedTarget || e.toElement;
          if (!from || from.nodeName == "HTML") {
              // stop your drag event here
              // for now we can just use an alert
              alert("You left the window! Game over;((");
              document.getElementById("submit").click();
          }
      });
  });
  function show(){
    var elem = document.getElementById("test");
    document.getElementById('intro').style.display = "none";
    document.getElementById('test').style.display = "block";
    if (elem.requestFullscreen) {
      elem.requestFullscreen();
    } else if (elem.mozRequestFullScreen) { /* Firefox */
      elem.mozRequestFullScreen();
    } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
      elem.webkitRequestFullscreen();
    } else if (elem.msRequestFullscreen) { /* IE/Edge */
      elem.msRequestFullscreen();
    }
  }
  // output functions are configurable.  This one just appends some text
  // to a pre element.
  function outf(text) {
      var mypre = document.getElementById("output");
      mypre.innerHTML = mypre.innerHTML + text;
  }
  function builtinRead(x) {
      if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
              throw "File not found: '" + x + "'";
      return Sk.builtinFiles["files"][x];
  }

  // Here's everything you need to run a python program in skulpt
  // grab the code from your textarea
  // get a reference to your pre element for output
  // configure the output function
  // call Sk.importMainWithBody()
  function runit() {
     var prog = document.getElementById("yourcode").value;
     var mypre = document.getElementById("output");
     mypre.innerHTML = '';
     Sk.pre = "output";
     Sk.configure({output:outf, read:builtinRead});
     (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
     var myPromise = Sk.misceval.asyncToPromise(function() {
         return Sk.importMainWithBody("<stdin>", false, prog, true);
     });
     myPromise.then(function(mod) {
         console.log('success');
     },
         function(err) {
         console.log(err.toString());
     });
  }
  </script>
</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
    <div class="container">
      <a class="navbar-brand" href="#">smarTest</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
    {% if username %}
    <p></p>
	  {% else %}
          <li class="nav-item">
            <a class="nav-link" href="#">Registration</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Login</a>
          </li>
	  {% endif %}
        </ul>
      </div>
    </div>
  </nav>

{% if username %}
          <div id="intro">
            <center>
            <h1><br/><br/><br/>Instructions</h1>
            <h3><ol>
              <li>Don't leave the screen with your cursor! Your test will end!</li>
            </ol></h3>
            <button onclick="show()">Start test!</button>
          </center>
          </div>
          <div id="test" style="display:none; background-color: white">
            <center>
            <h1>{{ testName }}</h1>
            <h3 id="demo"></h3>
            <script>
              var deadtime = '{{ data.endtime }}'
              var deadline = new Date(deadtime).getTime();
              var x = setInterval(function() {
                var now = new Date().getTime();
                var t = deadline - now;
                var days = Math.floor(t / (1000 * 60 * 60 * 24));
                var hours = Math.floor((t%(1000 * 60 * 60 * 24))/(1000 * 60 * 60));
                var minutes = Math.floor((t % (1000 * 60 * 60)) / (1000 * 60));
                var seconds = Math.floor((t % (1000 * 60)) / 1000);
                document.getElementById("demo").innerHTML = hours + "h " + minutes + "m " + seconds + "s ";
                if (t < 0) {
                  clearInterval(x);
                  document.getElementById("submit").click();
                }
              }, 1000);
            </script>

              <form action="{{ url_for('savetestsolve') }}" method="post">
                <input type="text" value="{{ testid }}" name="testid" style="display:none">
              {% for i in content %}

              <h4>{{ loop.index0 + 1 }}. {{ i[1] }}</h4><br/>
              {% set image = "test_pics/"+i[3] %}
              Points: {{ i[9] }}
              {% if i[3]!='' %}
              <img class="img-fluid" src="{{ url_for('static',filename=image) }}" style="max-width:100px" alt="">
              {% endif %}

              {% if i[2]=="open" %}
                <textarea name="answers[]" placeholder="{{ i[1] }}"></textarea>
              {% endif %}

              {% if i[2]=="closed" %}
              <br/>
              <input type="radio" name="answers[]" value="{{ i[4] }}">
              {{ i[4] }}
              <input type="radio" name="answers[]" value="{{ i[5] }}">
              {{ i[5] }}
              <input type="radio" name="answers[]" value="{{ i[6] }}">
              {{ i[6] }}
              <input type="radio" name="answers[]" value="{{ i[7] }}">
              {{ i[7] }}
              {% endif %}

              {% if i[2]=="drawn" %}
              drawn
              {% endif %}
              {% if i[2]=="coding" %}
              <br/><br/><textarea id="yourcode" cols="40" rows="10" name="answers[]" placeholder="{{ i[1] }}"></textarea><br/>
              <p onclick="runit()">Run</p>
              <pre id="output"></pre>
              <div id="mycanvas"></div>
              {% endif %}
              <hr/>
              {% endfor %}
              <input type="submit" id="submit">
            </form>
          </center>
          </div>
{% endif %}

  <!-- Footer -->
  <footer class="py-5 bg-black">
    <div class="container">
      <p class="m-0 text-center text-white small">smarTest 2020</p>
    </div>
    <!-- /.container -->
  </footer>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="{{ url_for('static',filename='js/map.js') }}"></script>

</body>

</html>
